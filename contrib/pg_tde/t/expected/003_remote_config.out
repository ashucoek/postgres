CREATE EXTENSION IF NOT EXISTS pg_tde;
SELECT pg_tde_add_database_key_provider_file('file-provider', json_object('type' VALUE 'remote', 'url' VALUE 'http://localhost:8888/hello'));
 pg_tde_add_database_key_provider_file 
---------------------------------------
                                     1
(1 row)

SELECT pg_tde_set_key_using_database_key_provider('test-db-key', 'file-provider');
 pg_tde_set_key_using_database_key_provider 
--------------------------------------------
 
(1 row)

CREATE TABLE test_enc2 (id SERIAL, k INTEGER, PRIMARY KEY (id)) USING tde_heap;
INSERT INTO test_enc2 (k) VALUES (5), (6);
SELECT * FROM test_enc2 ORDER BY id;
 id | k 
----+---
  1 | 5
  2 | 6
(2 rows)

-- server restart
SELECT * FROM test_enc2 ORDER BY id;
 id | k 
----+---
  1 | 5
  2 | 6
(2 rows)

DROP TABLE test_enc2;
DROP EXTENSION pg_tde;
